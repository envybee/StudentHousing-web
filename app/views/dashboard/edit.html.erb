<head>
	<%= render 'shared/common_dash_head' %>
	<style>
		#del_btn, #save_btn  {
			float: right;
			margin: 5px;
		}
	</style>
</head>
<body>
	<%= render 'shared/common_dash_nav' %>
	<div class="col-sm-9 col-md-10">
		<h2>Edit Listing</h2>
		<form class="form-horizontal" onSubmit="submitData(); return false;">
			<div class="form-group">
				<label for="housing_listing_name" class="col-sm-2 control-label">Name</label>
				<div class="col-sm-10">
					<input type="text" class="form-control" name="housing_listing_name" id="housing_listing_name" value="<%=@edit_listing.name%>">
				</div>
			</div>

			<div class="form-group">
				<label for="housing_listing_description" class="col-sm-2 control-label">Description</label>
				<div class="col-sm-10">
					<textarea class="form-control" class="form-control" name="housing_listing_description" id="housing_listing_description" rows="3"><%=@edit_listing.description%></textarea>
				</div>
			</div>

			<div class="form-group">
				<label for="housing_listing_location" class="col-sm-2 control-label">Location</label>
				<div class="col-sm-10">
					<input type="text" class="form-control" name="housing_listing_location" id="housing_listing_location" value="<%=@edit_listing.location%>"> 
				</div>
			</div>

			<div class="form-group">
				<label for="housing_listing_price" class="col-sm-2 control-label">Price</label>
				<div class="col-sm-10">
					<div class="input-group">
						<div class="input-group-addon">$</div>
						<input type="number" class="form-control" name='housing_listing_price' id="housing_listing_price" value="<%=@edit_listing.price%>">
					</div>
				</div>
			</div>
			
			<div class="form-group">
				<label for="housing_listing_street_address" class="col-sm-2 control-label">Street</label>
				<div class="col-sm-10">
					<input type="text" class="form-control" name='housing_listing_street_address' id="housing_listing_street_address" value="<%=@edit_listing.street_address%>">
				</div>
			</div>
			
			<div class="form-group">
				<label for="housing_listing_city" class="col-sm-2 control-label">City</label>
				<div class="col-sm-10">
					<input type="text" class="form-control" name='housing_listing_city' id="housing_listing_city" value="<%=@edit_listing.city%>">
				</div>
			</div>
			
			<div class="form-group">
				<label for="housing_listing_province" class="col-sm-2 control-label">Province</label>
				<div class="col-sm-10">
					<input type="text" class="form-control" name='housing_listing_province' id="housing_listing_province" value="<%=@edit_listing.province%>">
				</div>
			</div>
			
			<div class="form-group">
				<label for="housing_listing_country" class="col-sm-2 control-label">Country</label>
				<div class="col-sm-10">
					<input type="text" class="form-control" name='housing_listing_country' id="housing_listing_country" value="<%=@edit_listing.country%>">
				</div>
			</div>
			
			<div class="form-group">
				<label for="housing_listing_postal_code" class="col-sm-2 control-label">Postal Code</label>
				<div class="col-sm-10">
					<input type="text" class="form-control" name='housing_listing_postal_code' id="housing_listing_postal_code" value="<%=@edit_listing.postal_code%>">
				</div>
			</div>

			<br />
			<button type="button" class="btn btn-sm btn-danger" id="del_btn" data-toggle="modal" data-target="#confirm_diag">Delete</button>
			<button class="btn btn-sm btn-primary" id="save_btn" type="submit">Save</button>
		</form>
	</div>
	<div class="modal fade" id="confirm_diag" tabindex="-1" role="dialog" aria-labelledby="confirm_diag_title" aria-hidden="true">
		<div class="modal-dialog">
		<div class="modal-content">
		  <div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title" id="confirm_diag_title">Delete ad: <%= @edit_listing.name %>?</h4>
		  </div>
		  <div class="modal-body">
			<p>Are you sure you want to delete this ad?</p>
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-default" data-dismiss="modal">No</button>
			<button id="del_confirm" type="button" class="btn btn-primary">Yes</button>
		  </div>
		</div><!-- /.modal-content -->
	  </div><!-- /.modal-dialog -->
	</div>
</body>
<%= render 'shared/common_dash_scripts' %>
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script>

	var dashboard_index = "<%= dashboard_index_url %>";		
	var housing_listing_id = <%= @edit_listing.id %>;
	
	$("#del_confirm").on("click", function(e) {
		deleteEntry();
		$("#confirm_diag").modal('hide');
	});
	
	function deleteEntry() {
		var housing_listing_delete_api = "<%= api_delete_housing_listing_url %>";
		
		$.ajax({
		  async: false,
		  method: 'post',
		  url: housing_listing_delete_api,
		  data: {
			id: housing_listing_id
		  },
		  success: function(response){
			window.location.href = dashboard_index;
			console.log(response);
		  },
		  error: function(response) {
			console.log(response);
		  }
		});
	}
	
	function submitData() {
		var housing_listing_update_api = "<%= api_update_housing_listing_url %>";
		
		var name = $("#housing_listing_name").val();
		var description = $("#housing_listing_description").val();
		var location = $("#housing_listing_location").val();
		var price = $("#housing_listing_price").val();
		var street_address = $("#housing_listing_street_address").val();
		var city = $("#housing_listing_city").val();
		var province = $("#housing_listing_province").val();
		var country = $("#housing_listing_country").val();
		var postal_code = $("#housing_listing_postal_code").val();

		$.ajax({
		  async: false,
		  method: 'post',
		  url: housing_listing_update_api,
		  data: {
			id: housing_listing_id,
			name: name,
			description: description,
			location: location,
			price: price,
			street_address: street_address,
			city: city,
			province: province,
			country: country,
			postal_code: postal_code
		  },
		  success: function(response){
			window.location.href = dashboard_index;
			console.log(response);
		  },
		  error: function(response) {
			console.log(response);
		  }
		});
	}
</script>
