<html>
	<head>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="/assets/ladda/dist/ladda-themeless.min.css">

		<%= stylesheet_link_tag 'welcome_index.css'%>
	</head>

	<body>
		<%= render 'shared/common_front_nav' %>
	  	<div class="container" id="homepage">
	  		<div class="jumbotron">
	  			<div class="search_content_text">
	  				Let's find a great place for you.
	  			</div>
	  			<div class="form-horizontal">
				    <input name="search" id="address_input"/>
				    <button id="location_search_btn" href="/housing_listing/show" class="ladda-button btn btn-info btn-lg" data-style="slide-right">
				    	<i class="fa fa-search"></i>
				    		Search
				    </button>
				</div>
			</div>
		</div>
	</body>

	<div class="modal" id="login_modal" tabindex="-1" role="dialog" aria-labelledby="login_modal" aria-hidden="true">
	    <div class="modal-dialog modal-sm">
	        <div class="modal-content">
	            <div class="modal-header">
	              <h2>Login</h2>
	            </div>
	            <div class="modal-body">
	              	<%= form_for(:user, :url => session_path(:user)) do |f| %>
	              		<span>Email</span>
	                    <input type="text" class="form-control" name="user[email]" id="email" style="margin-bottom: 5px">
	                    <span>Password</span>
	                    <input type="password" class="form-control" name='user[password]'>
	                    <span class="help-block error" id="login_errors"></span>
	                    <span>
	                    	<input type="checkbox" name='user[remember_me]' id='remember_me' checked> Remember me
	                    	<span class="pull-right">
	                    		<%= link_to "Forgot your password?", new_password_path(:user) %>
	                    	</span>
	                    </span>
	                    <br />
	                    <button class="btn btn-lg btn-primary btn-block" id="login_btn" type="submit" style="margin-top:5px">Login</button>
	                    <span>Don't have an account yet? <a href="#" id="register_btn">Register</a> </span>
					<% end %>
	            </div>
	            
	        </div>
	    </div>
	</div><!-- end of login_modal -->

	<div class="modal" id="register_modal" tabindex="-1" role="dialog" aria-labelledby="register_modal" aria-hidden="true">
	    <div class="modal-dialog modal-md">
	        <div class="modal-content">
	            <div class="modal-header">
	              <h2>Sign up</h2>
	            </div>
	            <div class="modal-body">
	              	<%= form_for(:user, :url => registration_path(:user)) do |f| %>
	              		<span>Email</span>
	                    <input type="text" class="form-control" name="user[email]" id="user_email" style="margin-bottom: 5px">

	                    <div class="field">
		                  <span>First Name</span> 
		                  <input type="text" class="form-control" name="user[first_name]" id="first_name" style="margin-bottom: 5px">
		                </div>

		                <div class="field">
		                  <span>Last Name</span> 
		                  <input type="text" class="form-control" name="user[last_name]" id="last_name" style="margin-bottom: 5px">

		                  <div class="field">
	                    	<span>Password</span>
			                  <% if @validatable %>
			                  <em>(<%= @minimum_password_length %> characters minimum)</em>
			                  <% end %><br />
			                    <input type="password" class="form-control" name='user[password]' id="user_password">
			                    <span class="help-block error" id="login_errors"></span>
			                </div>

			                <div class="field">
	                    	<span>Password Confirmation</span>
			                <input type="password" class="form-control" name='user[password_confirmation]' id="user_password_confirmation">
                		 </div>

	                    <br />
	                    <button class="btn btn-lg btn-primary btn-block" id="login_btn" type="submit">Sign up</button>
					<% end %>
	            </div>
	            
	        </div>
	    </div>
	</div><!-- end of register_modal -->

</html>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=places"></script>
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
<script src="/assets/ladda/dist/spin.min.js"></script>
<script src="/assets/spin.js/jquery.spin.js"></script>
<script src="/assets/ladda/dist/ladda.min.js"></script>
<script>

$( document ).ready(function() {

		var address_input = document.getElementById('address_input');

	    address_autocomplete = new google.maps.places.Autocomplete(address_input, {
	        types: ['(cities)']
	    });

	    $("#sign_in_btn").on("click", function(e) {
	    	e.preventDefault();

	    	$("#login_modal").modal("show");
	    });

	    $("#register_btn").on("click", function(e) {
	    	e.preventDefault(); 

	    	$("#login_modal").modal("hide");
	    	$("#register_modal").modal("show");
	    });

	    var place;

	    google.maps.event.addListener(address_autocomplete, 'place_changed', function() {

		  place = address_autocomplete.getPlace();

		});

		$("#location_search_btn").on("click", function(e) {

			e.preventDefault();
  			var l = Ladda.create( document.querySelector( '#location_search_btn' ) );
  			l.start();

			if(place) {
				var address_components = place.address_components;
				var city, province, country;

			  for(var i = 0; i < place.address_components.length; i++) {
				  var addressType = place.address_components[i].types[0];
				  if(addressType == 'locality') {
				  	city = place.address_components[i].short_name;
				  } else if (addressType == 'administrative_area_level_1') {
				  	province = place.address_components[i].short_name;
				  } else if (addressType == 'country') {
				  	country = place.address_components[i].long_name;
				  }
			  }

			  console.log(city);
			  console.log(province);
			  console.log(country);

			  window.location.href = "/housing/listings/index/" + city + "/" + province + "/" + country;

			}

			l.stop();
		})
	});
</script>
